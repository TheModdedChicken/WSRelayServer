{
  "version": 3,
  "sources": ["../index.ts"],
  "sourcesContent": ["import { WebSocketServer, WebSocket } from \"ws\"\nimport { Snowflake } from \"nodejs-snowflake\"\nimport url from \"url\"\n\nconst wss = new WebSocketServer({ port: 8080 });\n\ninterface WSLink {\n\tid: string\n\tclient: WebSocket\n\tserver: WebSocket\n}\n\nlet WSLinks: WSLink[] = []\n\nwss.on('connection', function connection(ws, req) {\n\tif (!req.url) return ws.close();\n  const { query: { socket } } = url.parse(req.url, true);\n\tif (!socket) return ws.close();\n\n\tvar link: WSLink = {\n\t\tid: `${new Snowflake().getUniqueID()}`,\n\t\tclient: ws,\n\t\tserver: new WebSocket(socket as string)\n\t}\n\n\tlink.server.on('open', () => {\n\t\tlink.server.on('message', (data) => {\n\t\t\tconst curLink: WSLink | undefined = WSLinks.find(l => l.id === link.id)\n\t\t\tif (!curLink || !curLink.client) return ws.close();\n\t\t\tcurLink.client.send(data, (err) => { \n\t\t\t\tif (err) ws.send(JSON.stringify({ wsrs_error: \"client:received_error\" })) \n\t\t\t})\n\t\t})\n\t})\n\n\tlink.server.on('close', () => {\n\t\tconst curLinkIndex = WSLinks.findIndex(l => l.id === link.id)\n\t\tif (curLinkIndex === -1) return;\n\n\t\tWSLinks.splice(curLinkIndex, 1)[0].client.close()\n\t})\n\n\tlink.client.on('message', (data) => {\n\t\tconst curLink: WSLink | undefined = WSLinks.find(l => l.id === link.id)\n\t\tif (!curLink || !curLink.server) return ws.close();\n\t\tcurLink.server.send(data, (err) => { \n\t\t\tif (err) ws.send(JSON.stringify({ wsrs_error: \"client:received_error\" })) \n\t\t})\n\t})\n\n\tlink.client.on('close', () => {\n\t\tconst curLinkIndex = WSLinks.findIndex(l => l.id === link.id)\n\t\tif (curLinkIndex === -1) return;\n\n\t\tWSLinks.splice(curLinkIndex, 1)[0].server.close()\n\t})\n\n\tWSLinks.push(link)\n});"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA,gBAA2C;AAC3C,8BAA0B;AAC1B,iBAAgB;AAEhB,MAAM,MAAM,IAAI,0BAAgB,EAAE,MAAM;AAQxC,IAAI,UAAoB;AAExB,IAAI,GAAG,cAAc,oBAAoB,IAAI,KAAK;AACjD,MAAI,CAAC,IAAI;AAAK,WAAO,GAAG;AACvB,QAAM,EAAE,OAAO,EAAE,aAAa,mBAAI,MAAM,IAAI,KAAK;AAClD,MAAI,CAAC;AAAQ,WAAO,GAAG;AAEvB,MAAI,OAAe;AAAA,IAClB,IAAI,GAAG,IAAI,oCAAY;AAAA,IACvB,QAAQ;AAAA,IACR,QAAQ,IAAI,oBAAU;AAAA;AAGvB,OAAK,OAAO,GAAG,QAAQ,MAAM;AAC5B,SAAK,OAAO,GAAG,WAAW,CAAC,SAAS;AACnC,YAAM,UAA8B,QAAQ,KAAK,OAAK,EAAE,OAAO,KAAK;AACpE,UAAI,CAAC,WAAW,CAAC,QAAQ;AAAQ,eAAO,GAAG;AAC3C,cAAQ,OAAO,KAAK,MAAM,CAAC,QAAQ;AAClC,YAAI;AAAK,aAAG,KAAK,KAAK,UAAU,EAAE,YAAY;AAAA;AAAA;AAAA;AAKjD,OAAK,OAAO,GAAG,SAAS,MAAM;AAC7B,UAAM,eAAe,QAAQ,UAAU,OAAK,EAAE,OAAO,KAAK;AAC1D,QAAI,iBAAiB;AAAI;AAEzB,YAAQ,OAAO,cAAc,GAAG,GAAG,OAAO;AAAA;AAG3C,OAAK,OAAO,GAAG,WAAW,CAAC,SAAS;AACnC,UAAM,UAA8B,QAAQ,KAAK,OAAK,EAAE,OAAO,KAAK;AACpE,QAAI,CAAC,WAAW,CAAC,QAAQ;AAAQ,aAAO,GAAG;AAC3C,YAAQ,OAAO,KAAK,MAAM,CAAC,QAAQ;AAClC,UAAI;AAAK,WAAG,KAAK,KAAK,UAAU,EAAE,YAAY;AAAA;AAAA;AAIhD,OAAK,OAAO,GAAG,SAAS,MAAM;AAC7B,UAAM,eAAe,QAAQ,UAAU,OAAK,EAAE,OAAO,KAAK;AAC1D,QAAI,iBAAiB;AAAI;AAEzB,YAAQ,OAAO,cAAc,GAAG,GAAG,OAAO;AAAA;AAG3C,UAAQ,KAAK;AAAA;",
  "names": []
}
